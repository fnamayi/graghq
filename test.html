<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zone01 Profile - Test Suite</title>
    <style>
        body {
            font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            color: #ffffff;
            line-height: 1.6;
        }
        
        .test-section {
            background: #1a1a1a;
            border: 1px solid #333333;
            margin: 20px 0;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }

        .test-section h2 {
            color: #00ff88;
            border-bottom: 2px solid #00ff88;
            padding-bottom: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .test-item {
            margin: 15px 0;
            padding: 15px;
            border-left: 4px solid #ddd;
            background: #f9f9f9;
        }
        
        .test-item.pass {
            border-left-color: #4caf50;
            background: #e8f5e8;
        }
        
        .test-item.fail {
            border-left-color: #f44336;
            background: #ffebee;
        }
        
        .test-item.pending {
            border-left-color: #ff9800;
            background: #fff3e0;
        }
        
        .test-controls {
            margin: 20px 0;
            text-align: center;
        }
        
        .btn {
            background: #00ff88;
            color: #000000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            text-decoration: none;
            display: inline-block;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: #00cc6a;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }

        .btn.secondary {
            background: #4a5568;
            color: #ffffff;
        }

        .btn.secondary:hover {
            background: #2d3748;
        }

        .btn.danger {
            background: #ff6b6b;
            color: #ffffff;
        }

        .btn.danger:hover {
            background: #ff5252;
        }
        
        .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin-left: 10px;
        }
        
        .status.pass { background: #4caf50; color: white; }
        .status.fail { background: #f44336; color: white; }
        .status.pending { background: #ff9800; color: white; }
        
        .code {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
        
        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .requirement-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }
        
        .requirement-card h4 {
            margin-top: 0;
            color: #333;
        }
        
        .checklist {
            list-style: none;
            padding: 0;
        }
        
        .checklist li {
            margin: 8px 0;
            padding: 5px 0;
        }
        
        .checklist li:before {
            content: "‚òê ";
            color: #999;
            margin-right: 8px;
        }
        
        .checklist li.checked:before {
            content: "‚úÖ ";
            color: #4caf50;
        }
        
        .checklist li.failed:before {
            content: "‚ùå ";
            color: #f44336;
        }
    </style>
</head>
<body>
    <h1>üß™ Zone01 Profile - Test Suite</h1>
    <p>This page helps verify that all project requirements are met.</p>

    <div class="test-controls">
        <a href="index.html" class="btn">Open Main Application</a>
        <a href="graphiql.html" class="btn secondary">Open GraphiQL Explorer</a>
        <button class="btn" onclick="runAllTests()">Run All Tests</button>
        <button class="btn danger" onclick="testInvalidCredentials()">Test Invalid Login</button>
        <button class="btn secondary" onclick="showJWTToken()">View JWT Token</button>
    </div>

    <div class="test-section">
        <h2>üìã Project Requirements Checklist</h2>
        <div class="requirements-grid">
            <div class="requirement-card">
                <h4>Authentication</h4>
                <ul class="checklist">
                    <li id="req-login">Login functionality with username/email + password</li>
                    <li id="req-invalid-error">Appropriate error for invalid credentials</li>
                    <li id="req-logout">Logout functionality</li>
                    <li id="req-jwt-inspection">JWT token inspection for user ID</li>
                </ul>
            </div>
            
            <div class="requirement-card">
                <h4>Profile Sections (3 Required)</h4>
                <ul class="checklist">
                    <li id="req-section1">Section 1: Basic user identification</li>
                    <li id="req-section2">Section 2: XP amount/level information</li>
                    <li id="req-section3">Section 3: Audit information</li>
                    <li id="req-data-accuracy">Data accuracy verified with GraphiQL</li>
                </ul>
            </div>
            
            <div class="requirement-card">
                <h4>Statistics Section (Required)</h4>
                <ul class="checklist">
                    <li id="req-stats-section">Fourth section for graphical statistics</li>
                    <li id="req-svg-charts">At least 2 different SVG charts</li>
                    <li id="req-chart-accuracy">Charts display accurate data</li>
                    <li id="req-chart-types">Different chart types (line, bar, pie, etc.)</li>
                </ul>
            </div>
            
            <div class="requirement-card">
                <h4>GraphQL Queries</h4>
                <ul class="checklist">
                    <li id="req-normal-queries">Normal queries (basic user info)</li>
                    <li id="req-nested-queries">Nested queries (user with relations)</li>
                    <li id="req-argument-queries">Queries with arguments (filtering, sorting)</li>
                    <li id="req-aggregate-queries">Aggregate queries (sums, counts)</li>
                </ul>
            </div>
            
            <div class="requirement-card">
                <h4>Hosting & Access</h4>
                <ul class="checklist">
                    <li id="req-hosting">Profile accessible from host domain</li>
                    <li id="req-http-server">Works with python3 -m http.server</li>
                    <li id="req-file-structure">Clean, organized file structure</li>
                    <li id="req-no-external-deps">No external dependencies (pure JS/SVG)</li>
                </ul>
            </div>
            
            <div class="requirement-card">
                <h4>Bonus Features</h4>
                <ul class="checklist">
                    <li id="bonus-additional-info">Additional information beyond 3 sections</li>
                    <li id="bonus-extra-charts">Additional charts beyond required 2</li>
                    <li id="bonus-custom-graphiql">Custom GraphiQL interface</li>
                    <li id="bonus-skills-section">Skills/achievements section</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üîß Manual Testing Instructions</h2>
        
        <div class="test-item pending">
            <h4>1. Test Invalid Credentials</h4>
            <p>Click the "Test Invalid Login" button above or manually enter wrong credentials.</p>
            <p><strong>Expected:</strong> Appropriate error message should be displayed.</p>
        </div>
        
        <div class="test-item pending">
            <h4>2. Test Valid Login</h4>
            <p>Enter your Zone01 credentials in the main application.</p>
            <p><strong>Expected:</strong> Should successfully log in and show profile dashboard.</p>
        </div>
        
        <div class="test-item pending">
            <h4>3. Verify Profile Sections</h4>
            <p>Check that the profile contains exactly 4 sections:</p>
            <ul>
                <li>User Information (login, name, ID, level)</li>
                <li>Experience Points (total XP, transactions, progress)</li>
                <li>Audit Information (given, received, ratio)</li>
                <li>Graphical Statistics (charts and visualizations)</li>
            </ul>
        </div>
        
        <div class="test-item pending">
            <h4>4. Verify Data Accuracy</h4>
            <p>Use the GraphiQL explorer to verify the data shown in the profile:</p>
            <ol>
                <li>Open GraphiQL explorer</li>
                <li>Set your JWT token</li>
                <li>Run queries to verify user info, XP, and audit data</li>
                <li>Compare results with profile display</li>
            </ol>
        </div>
        
        <div class="test-item pending">
            <h4>5. Test Charts</h4>
            <p>Verify that multiple different SVG charts are displayed:</p>
            <ul>
                <li>‚úÖ XP Progress Over Time (line chart)</li>
                <li>‚úÖ Audit Ratio Visualization (bar chart)</li>
                <li>‚úÖ Project Pass/Fail Ratio (pie chart)</li>
                <li>‚úÖ XP Earned by Project (bar chart)</li>
                <li>‚úÖ Piscine (JS/Go) Statistics (grouped bar chart)</li>
                <li>‚úÖ Skills Chart (bar chart - bonus)</li>
            </ul>
            <p><strong>Total: 6 different chart types implemented!</strong></p>
        </div>
        
        <div class="test-item pending">
            <h4>6. Test Logout</h4>
            <p>Click the logout button and verify:</p>
            <ul>
                <li>User is logged out successfully</li>
                <li>Redirected to login page</li>
                <li>Token is cleared from storage</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>üìä GraphQL Query Examples</h2>
        <p>These queries demonstrate the required query types:</p>
        
        <h4>Normal Query:</h4>
        <div class="code">
{
  user {
    id
    login
    firstName
    lastName
  }
}
        </div>
        
        <h4>Nested Query:</h4>
        <div class="code">
{
  user {
    id
    login
    transactions(limit: 5) {
      amount
      createdAt
      type
    }
  }
}
        </div>
        
        <h4>Query with Arguments:</h4>
        <div class="code">
{
  transaction(
    where: {
      type: {_eq: "xp"},
      userId: {_eq: 123}
    },
    order_by: {createdAt: desc},
    limit: 10
  ) {
    amount
    createdAt
    path
  }
}
        </div>
        
        <h4>Aggregate Query:</h4>
        <div class="code">
{
  transaction_aggregate(
    where: {
      type: {_eq: "xp"},
      userId: {_eq: 123}
    }
  ) {
    aggregate {
      sum {
        amount
      }
      count
    }
  }
}
        </div>
    </div>

    <div class="test-section">
        <h2>ÔøΩ JWT Token Viewer</h2>
        <div id="jwt-section">
            <p>View and inspect your current JWT token:</p>
            <div id="jwt-display" style="margin: 20px 0;">
                <div style="background: #2a2a2a; border: 1px solid #333; padding: 16px; border-radius: 8px; margin: 12px 0;">
                    <strong>Token Status:</strong> <span id="token-status">Checking...</span>
                </div>
                <div style="background: #2a2a2a; border: 1px solid #333; padding: 16px; border-radius: 8px; margin: 12px 0;">
                    <strong>Token Preview:</strong><br>
                    <code id="token-preview" style="word-break: break-all; font-size: 12px; color: #00ff88;">Loading...</code>
                </div>
                <div style="background: #2a2a2a; border: 1px solid #333; padding: 16px; border-radius: 8px; margin: 12px 0;">
                    <strong>User Info:</strong>
                    <div id="user-info">Loading...</div>
                </div>
            </div>
            <div style="margin: 16px 0;">
                <button class="btn" onclick="copyToken()">Copy Full Token</button>
                <button class="btn secondary" onclick="refreshTokenInfo()">Refresh</button>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>ÔøΩüöÄ Hosting Instructions</h2>
        <p>To test hosting with Python HTTP server:</p>
        <div class="code">
# Navigate to project directory
cd /path/to/graphql

# Start HTTP server
python3 -m http.server 8000

# Open in browser
http://localhost:8000
        </div>

        <p>The application should work without any external dependencies or build steps.</p>
    </div>

    <script>
        function runAllTests() {
            // This would run automated tests if implemented
            alert('Manual testing required. Please follow the instructions above.');
        }
        
        function testInvalidCredentials() {
            // Open main app with test parameters
            window.open('index.html?test=invalid', '_blank');
        }

        function showJWTToken() {
            refreshTokenInfo();
            document.getElementById('jwt-section').scrollIntoView({ behavior: 'smooth' });
        }

        function parseJwt(token) {
            try {
                var base64Url = token.split('.')[1];
                var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (error) {
                console.error("Error parsing JWT:", error);
                return null;
            }
        }

        function refreshTokenInfo() {
            const token = localStorage.getItem('zone01_token') || localStorage.getItem('token') || localStorage.getItem('jwt');
            const statusEl = document.getElementById('token-status');
            const previewEl = document.getElementById('token-preview');
            const userInfoEl = document.getElementById('user-info');

            if (!token) {
                statusEl.innerHTML = '<span style="color: #ff6b6b;">‚ùå No token found</span>';
                previewEl.textContent = 'No JWT token available. Please login first.';
                userInfoEl.innerHTML = '<span style="color: #ff6b6b;">No user information available</span>';
                return;
            }

            try {
                const payload = parseJwt(token);
                const isExpired = payload.exp && payload.exp < Date.now() / 1000;

                // Status
                if (isExpired) {
                    statusEl.innerHTML = '<span style="color: #ff6b6b;">‚ùå Token expired</span>';
                } else {
                    statusEl.innerHTML = '<span style="color: #00ff88;">‚úÖ Token valid</span>';
                }

                // Preview
                const preview = token.length > 100
                    ? token.substring(0, 50) + '...' + token.substring(token.length - 50)
                    : token;
                previewEl.textContent = preview;

                // User info
                if (payload) {
                    userInfoEl.innerHTML = `
                        <div style="margin: 8px 0;"><strong>User ID:</strong> ${payload.sub || 'N/A'}</div>
                        <div style="margin: 8px 0;"><strong>Username:</strong> ${payload.username || payload.login || 'N/A'}</div>
                        <div style="margin: 8px 0;"><strong>Issued:</strong> ${payload.iat ? new Date(payload.iat * 1000).toLocaleString() : 'N/A'}</div>
                        <div style="margin: 8px 0;"><strong>Expires:</strong> ${payload.exp ? new Date(payload.exp * 1000).toLocaleString() : 'N/A'}</div>
                        <div style="margin: 8px 0;"><strong>Algorithm:</strong> ${payload.alg || 'N/A'}</div>
                    `;
                } else {
                    userInfoEl.innerHTML = '<span style="color: #ff6b6b;">Error parsing token payload</span>';
                }

            } catch (error) {
                statusEl.innerHTML = '<span style="color: #ff6b6b;">‚ùå Invalid token format</span>';
                previewEl.textContent = 'Error: ' + error.message;
                userInfoEl.innerHTML = '<span style="color: #ff6b6b;">Error parsing token</span>';
            }
        }

        async function copyToken() {
            const token = localStorage.getItem('zone01_token') || localStorage.getItem('token') || localStorage.getItem('jwt');

            if (!token) {
                alert('No JWT token available to copy');
                return;
            }

            try {
                await navigator.clipboard.writeText(token);
                alert('JWT token copied to clipboard!');
            } catch (error) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = token;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('JWT token copied to clipboard!');
            }
        }
        
        // Mark requirements as checked based on implementation
        document.addEventListener('DOMContentLoaded', () => {
            // These are automatically checked based on our implementation
            const implementedFeatures = [
                'req-login', 'req-invalid-error', 'req-logout', 'req-jwt-inspection',
                'req-section1', 'req-section2', 'req-section3',
                'req-stats-section', 'req-svg-charts', 'req-chart-types',
                'req-normal-queries', 'req-nested-queries', 'req-argument-queries', 'req-aggregate-queries',
                'req-http-server', 'req-file-structure', 'req-no-external-deps',
                'bonus-additional-info', 'bonus-extra-charts', 'bonus-custom-graphiql', 'bonus-skills-section'
            ];

            implementedFeatures.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.add('checked');
                }
            });

            // Initialize JWT token display
            refreshTokenInfo();
        });
    </script>
</body>
</html>
